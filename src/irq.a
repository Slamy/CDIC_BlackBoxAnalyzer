 nam cdic_irq
 ttl cdic_irq

edition set 1

 psect io68360_a,0,0,edition,0,0

a6_value:
    dc.l 0

store_a6:
    lea a6_value(pc),a0
    move.l a6,(a0)
    rts

FMA_IRQ:
	move.l a6,-(sp)
	move.l a6_value(pc),a6
	move.l d0,-(sp)

	move.w $E0301A,d0 ; clear flags
	move.w d0,int_fma_status(a6)

	move.l $0E03010,d0
	move.l d0,int_fma_dclk(a6)

	move.b #1,fma_irq_occured(a6) ; Indicate IRQ occured

	move.l (sp)+,d0
	move.l (sp)+,a6

    rte

FMV_IRQ:
	move.l a6,-(sp)
	move.l a6_value(pc),a6
	move.l d0,-(sp)
	move.l a0,-(sp)

	move.w $E04062,d0 ; clear flags
	move.w d0,int_fmv_status(a6)

	move.w $E04088,d0 ; clear flags
	move.w $E040E6,d0 ; clear flags
	move.w $E04092,d0 ; clear flags

	move.b #1,fmv_irq_occured(a6) ; Indicate IRQ occured

	move.b do_dma(a6),d0
	bne func_dma_do

	move.l (sp)+,a0
	move.l (sp)+,d0
	move.l (sp)+,a6

    rte

func_dma_do:
	move.b #0,do_dma(a6)

	move.b $80004040,int_dma_csr(a6)
	move.b #$ff,$80004040 ; CSR
	lea mpeg_buffer(a6),a0
	move.l a0,$8000404c ;MAC
	move.w #$0484,$8000404a ; Memory transfer count
	move.b #$04,$80004046 ; SCR = 0x04
	move.b #$12,$80004045 ; OCR	= 0x12
	move.b #$30,$80004044 ; DCR = 0x30
	move.b #$80,$80004047 ; CCR = 0x80

	move.w #$8000,$E040C0

	nop
	nop
	nop
	nop
	nop
	nop
	nop
	nop
	nop

	move.b $80004040,int_dma_csr2(a6)
	move.b $80004041,int_dma_csr3(a6)

	
	move.l (sp)+,a0
	move.l (sp)+,d0
	move.l (sp)+,a6

	rte

CDIC_IRQ:
	move.l a6,-(sp)
	move.l a6_value(pc),a6
	move.l d0,-(sp)

	move.w $303FFE,d0 ; clear flags on XBUF
	move.w d0,int_dbuf(a6)

	move.w $303FF4,d0 ; clear flags on ABUF
	move.w d0,int_abuf(a6)

	move.w $303FF6,d0 ; clear flags on XBUF
	move.w d0,int_xbuf(a6)

	move.w $303FFA,d0 ; clear flags on AUDCTL
	move.w d0,int_audctl(a6)

	move.b #1,cdic_irq_occured(a6) ; Indicate IRQ occured

	move.l (sp)+,d0
	move.l (sp)+,a6

    rte

TIMER_IRQ:

	rte


VIDEO_IRQ:

	rte


SLAVE_IRQ:

	rte

SET_UART_BAUD: 
	move.l a6,-(sp)
	move.l a6_value(pc),a6
	move.l d0,-(sp)

	move.w $303FF4,d0 ; clear flags on ABUFD
	move.w $303FF6,d0 ; clear flags on XBUF

	move.b #$ff,$80002015 ; 19200 Baud

	move.b #1,cdic_irq_occured(a6) ; Indicate IRQ occured

	move.l (sp)+,d0
	move.l (sp)+,a6

	rte

